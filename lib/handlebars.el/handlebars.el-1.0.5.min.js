!function(t){"object"==typeof exports?module.exports=t(require("lodash"),require("handlebars.phrase")):"function"==typeof define&&define.amd&&define(["lodash","handlebars.phrase"],t)}(function(_,Phrase){function registerHelper(t,e){Handlebars=t,e=e||"el",Handlebars.registerHelper(e,Element)}var Handlebars,defaults={"el-escape":!0,"el-tag":"div","el-join":"","el-reject":/^\s*$/,"el-split":/(\r\n|\n\r|\n|\r)+/g,"el-trim":!0},elementIsEmpty={area:!0,base:!0,br:!0,col:!0,hr:!0,img:!0,input:!0,link:!0,meta:!0,param:!0},elementCanHaveNoContent={textarea:!0,script:!0},elementHasContentAttribute={meta:!0},attributeCanHaveNoValue={alt:!0,value:!0},attributeIsBoolean={checked:!0,disabled:!0,selected:!0},attributeIsEnumerate={dir:["rtl","ltr"]},Element=function(){function getAttr(t){var e=attributes[t];return delete attributes[t],e}function trim12(t){for(var e=t.replace(/^\s\s*/,""),n=/\s/,r=e.length;n.test(e.charAt(--r)););return e.slice(0,r+1)}function jsonifyAttr(attr){if("string"==typeof attr&&(0===attr.indexOf("{")||0===attr.indexOf("[")))try{eval("attr = "+attr+";")}catch(e){}return attr}function wrapInner(t,e){e=jsonifyAttr(e);var n="object"==typeof e?_.cloneDeep(e):{"el-tag":e};return t=Handlebars.helpers.el(t,{hash:n})}var args=Array.prototype.slice.call(arguments),options=args.pop(),attributes=_.extend({},options.hash||{});if(attributes.attributes&&("object"!=typeof attributes.attributes&&(attributes.attributes={"el-tag":attributes.attributes}),attributes=_.extend({},attributes.attributes,attributes),delete attributes.attributes),attributes=_.extend({},defaults,attributes),!getAttr("el-abort-all")){var output="",context=this,tagName=getAttr("el-tag").toLowerCase(),escape=getAttr("el-escape"),wrap=getAttr("el-wrap"),wrapAll=getAttr("el-wrap-all"),wrapOuter=getAttr("el-wrap-outer"),join=getAttr("el-join"),split=getAttr("el-split"),reject=getAttr("el-reject"),firstMatch=getAttr("el-first-match"),ternary=getAttr("el-ternary"),abort=getAttr("el-abort"),trim=getAttr("el-trim"),fallback=getAttr("el-fallback"),fallbackClass=getAttr("el-fallback-class"),contentBefore=getAttr("el-content-before"),contentAfter=getAttr("el-content-after"),lang=getAttr("el-lang");for(var elfallbackprop in attributes)if(0===elfallbackprop.indexOf("el-fallback-")){var matchprop=elfallbackprop.match(/^el-fallback-(.*)/)[1];void 0===attributes[matchprop]&&(attributes[matchprop]=attributes[elfallbackprop]),delete attributes[elfallbackprop]}var empty=elementIsEmpty[tagName],contents=getAttr("contents"),content=args.shift();args.length&&(content=[content].concat(args)),options.fn&&(content=options.fn(this)),void 0===content&&(elementHasContentAttribute[tagName]||(content=attributes.content),void 0===content&&(content=attributes["el-content"])),elementHasContentAttribute[tagName]||delete attributes.content,delete attributes["el-content"],!content&&contents&&"boolean"!=typeof contents&&(content=contents,contents=!0),"img"!==tagName||attributes.alt||(attributes.alt="");var chunks=[""];if(!content&&fallback&&(content=fallback),content){if("function"==typeof content&&(content=content(attributes["el-params-content"],context)),_.isArray(content))chunks=content;else if(split){"number"==typeof content&&(content=content.toString()),content.split||console.log("no split for content",content);for(var tmpChunks=content.split(split),tmpChunk=0;tmpChunk<tmpChunks.length;tmpChunk++)tmpChunks[tmpChunk]&&!tmpChunks[tmpChunk].match(split)&&chunks.push(tmpChunks[tmpChunk])}else chunks=[content];if(void 0!==ternary&&2===chunks.length){var ternaryChunk=ternary?0:1;chunks=[chunks[ternaryChunk]]}if(firstMatch)for(var fchunk in chunks)if(chunks[fchunk]||0===chunks[fchunk]){chunks=[chunks[fchunk]];break}for(var cchunk in chunks)chunks[cchunk]&&(attributes["el-content-phrase"]?chunks[cchunk]=Phrase.get(chunks[cchunk],{},context,lang):"function"==typeof chunks[cchunk]&&(chunks[cchunk]=chunks[cchunk](attributes["el-content-params"],context)));if(wrap&&!contents&&!abort){for(var chunk in chunks)chunks[chunk]=wrapInner(chunks[chunk],wrap);chunks=[chunks.join("")],escape=!1,wrap=null}contents||(chunks=[chunks.join(join)]),wrapAll&&!abort&&(chunks[0]=wrapInner(chunks[0],wrapAll),escape=!1,wrapAll=null)}if(abort)return chunks.join("");fallbackClass&&_.isEmpty(attributes["class"])&&(attributes["class"]=fallbackClass),elementCanHaveNoContent[tagName]&&(attributes["el-force"]=!0);for(var i=0,clength=chunks.length;clength>i;i++){var contentChunk=chunks[i];if(trim&&("number"==typeof contentChunk&&(contentChunk=contentChunk.toString()),contentChunk=trim12(contentChunk)),empty||attributes["el-force"]||!contentChunk.match(reject)){var attrStr="",keys=_.keys(attributes).sort();for(var key in keys){var prop=keys[key];if(0!==prop.indexOf("el-")){var attr=attributes[prop],escapeAttr=!0,escapeFlag=attributes["el-escape-"+prop];void 0===escapeFlag||escapeFlag||(escapeAttr=!1),"function"==typeof attr&&(attr=attr(attributes["el-params-"+prop])),"class"===prop&&attr.join&&(attr=attr.sort().join(" ")),(attr||attributeCanHaveNoValue[prop])&&(attrStr+=" "+prop,attributeIsBoolean[prop]||(escapeAttr&&(attr=Handlebars.Utils.escapeExpression(attr)),attrStr+='="'+attr+'"'))}}escape!==!1&&(contentChunk=Handlebars.Utils.escapeExpression(contentChunk)),output+="<"+tagName+attrStr+">",empty||(wrap&&(contentChunk=wrapInner(contentChunk,wrap)),contentBefore&&(output+=contentBefore),output+=contentChunk,contentAfter&&(output+=contentAfter),output+="</"+tagName+">")}}if(output&&wrapOuter){var wrapOuterOptions={hash:{attributes:wrapOuter,content:output,"el-escape":!1}};output=Handlebars.helpers.el(wrapOuterOptions)}return output}};return{registerHelper:registerHelper,registerHelpers:registerHelper}});